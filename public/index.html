<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTC Call API Example</title>
</head>
<style>
    /* iframe {
        border: none;
    } */

    body {
        background-color: black;
    }
</style>

<body>
    <div id="call-container"></div>

    <!-- Include thet bundled JavaScript file -->
    <!-- <script src="https://iframe-api-cdn.onrender.com/rtccallapi_external.js"></script> -->
    <script src="rtccallapi_external.js"></script>
    <script>

        // Ensure the script runs after the bundle is loaded
        let participant = {};
        document.addEventListener('DOMContentLoaded', () => {
            // Define the options for the RTCCallApi instance
            const options = {
                callId: '02nubqcrsvr',
                containerId: 'call-container',
                userConfig: {
                    displayName: 'John Mark',
                    jobId: (Math.random() * 100).toString('32').replace('.', ''),
                    profilePicuteUrl: '',
                    color: '#56f34d'
                },
                interfaceConfig: {
                    width: '400px',
                    height: '500px',
                    title: 'Test Call',
                    subtitle: 'Iframe Api',
                    backgroundColor: 'blue',
                    muteCam: true,
                    muteMic: true
                }
            };

            // Create an instance of the RTCCallApi class from the exposed library
            const rtcCallApi = new RTCCallApiLibrary.RTCCallApi(options);

            // Add event listeners
            rtcCallApi.addEventListener('participantLeft', (data) => {
                console.log('participant left.', data); //this.participant(data)

            });
            rtcCallApi.addEventListener('leftCall', (data) => {
                console.log('you left the call.', data); //this.participant(data)
            });
            rtcCallApi.addEventListener('peerLeft', async (data) => {
                console.log('participant left left.', data); //this.participant(data)
                const callInfo = await rtcCallApi.sendCommand('getCallInfo',
                    {});
                console.log('callInfo: ', callInfo)
            });

            rtcCallApi.addEventListener('participantJoined', (data) => {
                console.log('participant: ', participant)
                console.log('participant joined event: ', data);
                participant = data.participant;
                console.log('participant: ', participant)
            });
            rtcCallApi.addEventListener('newPeer', (data) => {
                console.log('new peer added: ', data)
            });
            rtcCallApi.addEventListener('isRejoining', (data) => {
                console.log('user rejoining: ', data)
            })
            // rtcCallApi.addEventListener('isRejoining', (data) => {
            //     console.log('user rejoining: ', data)
            // })
            // rtcCallApi.addEventListener('isRejoining', (data) => {
            //     console.log('user rejoining: ', data)
            // })
            // rtcCallApi.addEventListener('isRejoining', (data) => {
            //     console.log('user rejoining: ', data)
            // })

            // Send commands
            // rtcCallApi.sendCommand(RTCCallApiLibrary.RTC_CALL_COMMANDS.START_CALL, { someData: 'example' });
            setTimeout(async () => {
                const callInfo = await rtcCallApi.sendCommand('getCallInfo',
                    {});
                console.log('callInfo: ', callInfo)
            }, 7000);
        });

    </script>
</body>

</html>